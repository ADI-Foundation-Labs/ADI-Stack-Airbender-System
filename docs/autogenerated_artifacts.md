# Autogenerated verifier artifacts

This document explains what the autogenerated verifier files are, how to (re)generate them, and how the generation pipeline works in this repository.

In this repository, "each circuit" refers to a concrete proving/verification target.

`Machine circuits`: Variants of the RISC-V execution machine with different modes and aka recursion/proving strategies (e.g., reduced machines, final reduced machine, configurations without signed mul/div for recursion, etc.).

`Delegation circuits`: Specialized sub-circuits that the machine delegates to for heavy operations, such as BLAKE2 compression or big-integer arithmetic with control.

The automation currently handles the following circuit names (see `recreate_verifiers.sh`):

- `risc_v_cycles` — machine for proving full RISC‑V cycles
- `reduced_risc_v_machine` — stripped-down RISC-V machine for recursion
- `reduced_risc_v_log_23_machine` — reduced machine variant for log_23 recursion
- `final_reduced_risc_v_machine` — final-stage reduced machine circuit used in recursion pipelines
- `machine_without_signed_mul_div` — machine variant without signed multiply/divide
- `blake2_with_compression` — reference circuit for BLAKE2 hashing (exact scope depends on ABI)
- `bigint_with_control` — reference circuit for 256‑bit arithmetic primitives (scope depends on ABI)

Each has its own directory under `circuit_defs/<circuit>/`, with a `generated/` subfolder that contains that circuit’s `circuit_layout.rs`, `quotient.rs`, layout JSON, and witness generation functions (`witness_generation_fn.rs`). When you recreate verifiers, the template verifier is copied and stamped for each of these circuits.

For deeper background on these categories, see:

[Delegation circuits](./delegation_circuits.md) 

[Machine configuration](./machine_configuration.md)

For each circuit, the verifier uses a small set of static, generated artifacts. In the verifier template they live under `verifier/src/generated/`:

- `circuit_layout.rs`: Generated verifier layout for a specific circuit. Encodes the column structure, lookup descriptions, masks, and other static metadata the verifier needs.
- `quotient.rs`: Generated, inlined code that evaluates the quotient polynomial constraints for that circuit at a random point; the verifier uses it to check the constraint system.

Per-circuit directories under `circuit_defs/<circuit>/generated/` contain the same kinds of files (and a few more, e.g., witness generation stubs) which get copied into a circuit-specific verifier when you recreate verifiers.


## How the generator works

Circuit definitions and layouts are produced by the prover/generator pipeline under `tools/generator` and are consumed by the verifier generator crate `verifier_generator`. The generator reads the delegation/circuit layout JSON and produces Rust code that the verifier links into `generated.rs` -> becomes `circuit_layout.rs` and `generated_inlined_verifier.rs` -> becomes `quotient.rs` (constraint evaluation at a point). The template verifier at `verifier/` uses these files under `verifier/src/generated/`.

References in this repo that perform these steps:

1. `verifier_generator/dump.sh` runs the generator tests that emit `src/generated.rs` and `src/generated_inlined_verifier.rs`, formats them, and copies them into `verifier/src/generated/` as `circuit_layout.rs` and `quotient.rs`.
2. Top-level `recreate_verifiers.sh` regenerates artifacts for all circuits via `tools/generator`, then copies each circuit's generated files into a fresh verifier template copied to that circuit directory.

## Regenerating the top-level verifier template artifacts

Use this when you want to refresh the generated/template files under `verifier/src/generated/`:

```bash
cd zksync-airbender/verifier_generator
chmod +x dump.sh
./dump.sh
```

## Regenerating artifacts for all circuits 

Use this when you make some changes in circuits and you want to update every circuit and rebuild per-circuit verifier crates:

```bash
chmod +x recreate_verifiers.sh
./recreate_verifiers.sh
```

## Typical workflows

Update the template verifier’s example generated files: run the steps in "Regenerating the top-level verifier template artifacts".
Update all circuits and their dedicated verifier crates: run the steps in "Regenerating artifacts for all circuits".

## Notes 

1. The generated files are deterministic with respect to the circuit layout and the generator version. If you change circuit definitions or generator logic, you must re-run the scripts.
2. Avoid manually editing anything under `.../generated/`. Circuit verifier directories are stamped from the template and marked as generated by script.
3. If you only need to examine layout structure or constraints, check `verifier/src/generated/circuit_layout.rs` and `verifier/src/generated/quotient.rs` in the template.

## Further reading

- [Circuit overview](./circuit_overview.md) — high-level architecture of circuits and constraints.
- [Machine configuration](./machine_configuration.md) — detailed machine variants (full/minimal, with/without delegation).
- [Delegation circuits](./delegation_circuits.md) — BLAKE2 and BigInt delegation details and integration.
- [Overview](./overview.md) — system-wide overview and how pieces fit together.
